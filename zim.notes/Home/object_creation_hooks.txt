Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2011-01-03T14:23:16.664803

====== object creation hooks ======

class //Object																<<- //make .timestamp(=) available to all .new objects
	attr_accessor :timestamp

end

Then, we need to hook object creation to add this timestamp. One way to do this is to do
our method-renaming trick on Class#new, the method that’s called to allocate space for a new
object.

class Class
	old_new = __instance_method__ :new
	__define_method__ :new do |*args, &block|

		result = old_new__.bind(self)__.call(*args, &block)
		result.timestamp = Time.now
		result

	end

end

Finally, we can run a test. We’ll create a couple of objects a few milliseconds apart and check their timestamps:

class Test
end

obj1 = Test.new
sleep(0.002)

obj2 = Test.new
obj1.timestamp.to_f											 => 1289843608.334771
obj2.timestamp.to_f											 => 1289843608.336811


